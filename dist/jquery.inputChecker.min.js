!function(t){t.fn.inputChecker=function(e){var n={inputParent:".input-parent",errorClass:"error",successClass:"success",helpBlockClass:"help-block",inputEvents:["change"],onSuccess:null,onError:null,onTest:null},s=t.extend({},n,e),r=function(e){this.check=function(t){if(void 0==t.data("ic-rules"))return!1;this.removeError(t),this.removeSuccess(t);var e=t.data("ic-rules").split("|"),n=t.val();if(e.indexOf("notempty")>-1&&""==n)return this.addError(t);if(e.indexOf("numeric")>-1){var s=new RegExp("^[0-9]*$");if(!s.test(n))return this.addError(t)}if(this.indexOf(e,"length")>-1){var r=e[this.indexOf(e,"length")],i=parseInt(r.split("-")[1]);if(n.length!=i)return this.addError(t)}if(this.indexOf(e,"min")>-1){var r=e[this.indexOf(e,"min")],a=parseInt(r.split("-")[1]);if(n.length<a)return this.addError(t)}if(this.indexOf(e,"max")>-1){var r=e[this.indexOf(e,"max")],c=parseInt(r.split("-")[1]);if(n.length>c)return this.addError(t)}return!0},this.removeError=function(t){var n=t.parents(e.inputParent);n.removeClass(e.errorClass),n.find("."+e.helpBlockClass).remove()},this.addError=function(n){var s=n.parents(e.inputParent);return this.removeError(n),s.addClass(e.errorClass),s.append(t("<span />",{"class":e.helpBlockClass,html:n.data("ic-message")})),!1},this.removeSuccess=function(t){var n=t.parents(e.inputParent);n.removeClass(e.successClass),n.find("."+e.helpBlockClass).remove()},this.addSuccess=function(n){var s=n.parents(e.inputParent);return this.removeSuccess(n),s.addClass(e.successClass),s.append(t("<span />",{"class":e.helpBlockClass,html:"Le teste est valide"})),!0},this.indexOf=function(e,n){var s=-1;return t.each(e,function(t,e){return e.indexOf(n)>-1?void(s=t):void 0}),s},this.test=function(n){var s=this,r=!1;return t.ajax({url:n.data("ic-test").replace("$value",n.val()),type:"GET",async:!1,success:function(i){null!=e.onTest&&(e.onTest(i,n.val())?(t("[data-ic-submit]").removeAttr("disabled"),r=s.addSuccess(n)):(t("[data-ic-submit]").attr("disabled",""),r=s.addError(n)))},error:function(t){alert("Fichier de test\n"+t.responseText),r=!1}}),r}};return this.each(function(){var e=new r(s),n=t(this);n.find("[data-ic]").each(function(){t(this).on(s.inputEvents.join(" "),function(){e.check(t(this))})}),n.on("submit",function(r){t(this).find("[data-ic]").each(function(){e.check(t(this))}),t(this).find("[data-ic-test]").each(function(){e.test(t(this))}),n.find("."+s.errorClass).length>0?(r.preventDefault(),null!=s.onError&&s.onError()):null!=s.onSuccess&&s.onSuccess()}),n.find("[data-ic-test-btn]").on("click",function(s){s.preventDefault(),n.find("[data-ic-test]").each(function(){e.test(t(this))})})})}}(jQuery);
